
<html>
<style type="text/css">
<!--
.button {
  border-radius: 3px;
  -moz-border-radius: 3px;
  background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#ddd));
  background: -moz-linear-gradient(top, #fff, #ddd);  
  border: 1px solid #bbb;
}

.button:active {
        background: -webkit-gradient(linear, left top, left bottom, from(#aaa), to(#333)); 
        background: -moz-linear-gradient(bottom, #ddd, #aaa); }

-->
</style>
<body>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js"></script>
<script src="//plus.google.com/hangouts/_/api/v1/hangout.js"></script>

<h3>Simple Hangout App</h3>

<button id="StartRound">Start Round</button>

<div id="cardsDiv"></div>

<div id="chosenCards"></div>

<hr>

<p><a href="http://developers.google.com/+/hangouts/getting-started">Read the docs</a> to learn more about developing hangouts!</a></p>

<script>
function showCards() {

  var index, card, retVal = '<p>White Cards: </p><ul>';

  for (index in window.myWhiteCards) {
    card = window.myWhiteCards[index];

    retVal += '<li>' + card + '</li>';
  }

  retVal += '</ul>';
  retVal += '<p>Black Cards: </p><ul>';

  for (index in window.activeBlackCard) {
    card = window.activeBlackCard[index];

    retVal += '<li>' + card + '</li>';
  }

  retVal += '</ul>';

  var div = document.getElementById('cardsDiv');

  div.innerHTML = retVal;
}
var white_cards = [
  'Being on fire.',
  'Racism.',
  'Old-people smell.',
  'A micropenis.',
  'Women in yogurt commercials.',
  'Classist undertones.',
  'Not giving a shit about the Third World.',
  'Sexting.',
  'Roofies.',
  'A windmill full of corpses.',
  'The gays.',
  'An oversized lollipop.',
  'African children.',
  'An asymmetric boob job.',
  'Bingeing and purging.',
  'The hardworking Mexican.',
  'An Oedipus complex.',
  'A tiny horse.',
  'Boogers.',
  'Penis envy.',
  'Barack Obama.',
  'My humps.',
  'The Tempur-Pedic(r) Swedish Sleep System(tm).',
  'Scientology.',
  'Dry heaving.',
  'Skeletor.',
  'Darth Vader.',
  'Figgy pudding.',
  'Advice from a wise, old black man.',
  'Five-Dollar Footlongs(tm).',
  'Elderly Japanese men.',
  'Free samples.',
  'Estrogen.',
  'Sexual tension.',
  'Famine.',
  'A stray pube.',
  'Men.',
  'Heartwarming orphans.',
  'Genital piercings.',
  'A bag of magic beans.'
  ];
var black_cards = [
  'How did I lose my virginity?',
  'Why can\'t I sleep at night?',
  'What\'s that smell?',
  'I got 99 problems but _______ ain\'t one.',
  'Maybe she\'s born with it.  Maybe it\'s _______',
  'What\'s the next Happy Meal(r) toy?',
  'Here is the church<br />Here is the steeple<br />Open the doors<br />And there is<br />_______',
  "It's a pity that kids these days are all getting involved with _______.",
  "During his childhood, Salvador Dali produced hundreds of paintings of _______."
  ];

function Deck(cards) {
  this.cards = cards.concat([]);
}
console.log(document.querySelectorAll('#StartRound'));
document.querySelectorAll('#StartRound')[0].addEventListener('onclick', function() {
  drawActiveBlackCard(new Deck(getBlackCards()));
});

Deck.prototype.shuffle = function() {
  function swap(cards, a, b) {
    var swapped = cards[a];
    cards[a] = cards[b];
    cards[b] = swapped;
  }

  for (var i = 0, len = this.cards.length; i < len ; i++) {
    swap(this.cards, i, Math.floor(Math.random() * len));
  }

};

Deck.prototype.drawCard = function(number) {
  return this.cards.splice(0, number);
};

function getValue(key) {
  return JSON.parse(this.getValue(key) || 'null');
}

function setValue(key, cards) {
  this.setValue(key, JSON.stringify(cards || null));
  return;
}

function drawActiveBlackCard(blackCards) {
  window.activeBlackCard = blackCards.drawCard(1);
  setActiveBlackCard(window.activeBlackCard);
  showCards();
}

var getWhiteCards = getValue.bind(gapi.hangout.data, 'white_cards'),
    setWhiteCards = setValue.bind(gapi.hangout.data, 'white_cards'),
    getBlackCards = getValue.bind(gapi.hangout.data, 'black_cards'),
    setBlackCards = setValue.bind(gapi.hangout.data, 'black_cards'),
    getActiveBlackCard = getValue.bind(gapi.hangout.data, 'active_black_card'),
    setActiveBlackCard = setValue.bind(gapi.hangout.data, 'active_black_card');

function init() {
  // When API is ready...
  gapi.hangout.onApiReady.add(
      function(eventObj) {
        var whiteDeck, blackDeck;
        if (eventObj.isApiReady) {
          var w_deck = getWhiteCards(),
              b_deck = getBlackCards(),
              a_black_card = getActiveBlackCard();

          gapi.hangout.data.onStateChanged.add(function(evt) {
            console.log(evt);
          });
          if(!w_deck) {
            whiteDeck = new Deck(white_cards);
            whiteDeck.shuffle();
            whiteDeck.shuffle();
            whiteDeck.shuffle();
          } else {
            whiteDeck = new Deck(w_deck);
          }

          if(!b_deck) {
            blackDeck = new Deck(black_cards);
            blackDeck.shuffle();
            blackDeck.shuffle();
            blackDeck.shuffle();
            setBlackCards(blackDeck.cards);
          } else {
            blackDeck = new Deck(b_deck);
          }

          window.myWhiteCards = whiteDeck.drawCard(10);

          if(!!a_black_card) {
            window.activeBlackCard = a_black_card;
          }

          setWhiteCards(whiteDeck.cards);
          showCards();

        }
      });
}

// Wait for gadget to load.
gadgets.util.registerOnLoadHandler(init);
</script>
</body>
</html>